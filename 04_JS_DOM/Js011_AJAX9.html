<!--
■ 영화진흥위원회 : 일별 박스 오피스
http://www.kobis.or.kr/kobisopenapi/homepg/apiservice/searchServiceInfo.do
 
http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.xml  (XML)
http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json  (JSON)
    key : (발급키)
    targetDt : (날짜yyyyMMdd)
    multiMovieYn : 영화구분,  "Y" : 다양성 영화 "N" : 상업영화 (default : 전체)
    repNationCd : 국내국외영화구분, "K": 한국영화 "F" : 외국영화 (default : 전체)
    itemPerPage : 결과 row 의 개수 (default : "10", 최대 : "10")
   
샘플url
 
XML 버젼
http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.xml?key=f5eef3421c602c6cb7ea224104795888&targetDt=20120101
 
JSON 버젼
http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=f5eef3421c602c6cb7ea224104795888&targetDt=20120101
 
-->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>영화목록조회 - 영화진흥위원회</title>
<style>

table,th,td {
  border : 1px solid black;
  border-collapse: collapse;
}
th,td {
  padding: 5px;
}

table#demoJSON {
  width: 750px;
  border: none;
}
table#demoJSON th {
  padding: 5px;
  border: none;
  border-bottom : 2px solid black;
}
table#demoJSON td{
    padding: 5px;    
    border: none;
    border-bottom : 1px solid rgba(80,80,80,0.1);
}

span{
    color:red;
    font-size : 0.3em;
}

</style>
</head>
 

<body>
    <h1>일별박스오피스</h1>
    <form>
    <table>
        <tr>
            <th>날짜</th>
            <td><input type="date" id="targetDt" name="targetDt" value="2022-05-18" placeholder="yyyy-mm-dd"/></td>
        </tr>
        <tr>
            <th>영화구분</th>
            <td>
                <select name="multiMovieYn" id="multiMovieYn">
                    <option value="">전체</option>
                    <option value="Y">다양성 영화</option>
                    <option value="N">상업영화</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>국내국외영화구분</th>
            <td>
                <select name="repNationCd" id="repNationCd">
                    <option value="">전체</option>
                    <option value="K">한국영화</option>
                    <option value="F">외국영화</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>출력ROW</th>
            <td>
                <input type="number" id="itemPerPage" name="itemPerPage" value="10"/>    
            </td>
        </tr>

    </table>
    <br>
    
    <button type="button" onclick="loadData()">정보 가져오기</button>
    <button type="button" onclick="removeTable()">지우기</button>
    </form>
    <hr>
    <h2>검색결과</h2>
    <table id="demoJSON"></table>
    
    
    <script>
    var api_key = "29fa5d73c45747875a9e9474cb9b1edd";
    
    function removeTable(){
        document.getElementById('demoJSON').removeChild(document.getElementById('demoJSON').childNodes[0]);
    }
    
    function loadData() {
        let targetDt, multiMovieYn, repNationCd, itemPerPage, url, xhttp, date = [];
    
        targetDt = document.getElementById('targetDt').value.trim();
        multiMovieYn = document.getElementById('multiMovieYn').value.trim();
        repNationCd = document.getElementById('repNationCd').value.trim();
        itemPerPage = document.getElementById('itemPerPage').value.trim();

        //유효성검증        
        datePat = /\d{1,4}-(0[1-9]|1[0-2])-(0[1-9]|1\d|2\d|3[0-1])/;

        //날짜
        if(!datePat.test(targetDt)){
            alert("날짜포멧이 맞지 않습니다.");
            document.getElementById('targetDt').focus();
            return;
        }else if(isNaN(itemPerPage) || itemPerPage <= 0 || itemPerPage > 10){
            alert("출력ROW는 1 ~ 10 사이의 정수이어야 합니다");
            document.getElementById('itemPerPage').focus();
            return;
        }


        //날짜 형식 변경
        targetDt.split("-").forEach(e => {
            date.push(e);
        });
        
        url =  `http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=${api_key}&targetDt=${date.join("")}&itemPerPage=${itemPerPage}`;

        //영화구분 선택 시 queryString 추가
        if(multiMovieYn != "") url += `&multiMovieYn=${multiMovieYn}`;

        //국내외영화구분 선택 시 queryString 추가
        if(repNationCd != "") url += `&repNationCd=${repNationCd}`;

       
        xhttp = new XMLHttpRequest();
    
        xhttp.onreadystatechange = function(){
            if(this.readyState == 4 && this.status == 200){
                let jsonObj = JSON.parse(this.responseText);
                //alert(this.responseText);
                parseJSON(jsonObj);
            }
        };
    
        xhttp.open("GET", url, true);
        xhttp.send();
        
    }
    
    function parseJSON(jsonText){
    
        const table = [];
        comPat = /\B(?=(\d{3})+(?!\d))/g;
        table.push("<tr><th>순위</th><th>영화명</th><th>누적관객수</th><th>전일대비순위증감</th></tr>");

        for(x of jsonText.boxOfficeResult.dailyBoxOfficeList){
            let tdStyle = "", newData = "" ,arrow = "" ,rankInten = 0;
            rankInten = parseInt(x.rankInten);
            
            tdStyle = (rankInten > 0) ? `style="color:red"` : (rankInten < 0) ? `style="color:blue"`: "" ;
            arrow   = (rankInten > 0) ? `↑` : (rankInten < 0)? `↓` : "";
            newData = (x.rankOldAndNew == "NEW") ? `<span>NEW</span>` : ``;
            table.push(`
            <tr>
                <td style="width:40px">${x.rank} ${newData}</td>
                <td style="width:425px">${x.movieNm}</td>
                <td style="width:100px">${x.audiAcc.replace(comPat,",")}명</td>
                <td ${tdStyle}>${arrow}${Math.abs(rankInten) == 0 ? "-" : Math.abs(rankInten) }</td>
            </tr>
            
            `);
        }
    
        document.getElementById('demoJSON').innerHTML = table.join('\n');
    
    }


    </script>
    
    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    </body>
    </html>